var A=a=>typeof a=='undefined';(function(_){"use strict";var b=function(B){var B=B||{};this.a=B.a||0.01;this.out_sx=B.in_sx;this.out_sy=B.in_sy;this.out_depth=B.in_depth;this.layer_type='leaky_relu'},c=function(E){var E=E||{};this.a=E.a||0.01;this.out_sx=E.in_sx;this.out_sy=E.in_sy;this.out_depth=E.in_depth;this.layer_type='elu'},d=function(aD){var aD=aD||{};this.b=aD.b||0.05;this.out_sx=aD.in_sx;this.out_sy=aD.in_sy;this.out_depth=aD.in_depth;this.layer_type='frelu'},e=function(aI){var aI=aI||{};this.out_sx=aI.in_sx;this.out_sy=aI.in_sy;this.out_depth=aI.in_depth;this.layer_type='swish'},f=function(aO){var aO=aO||{};this.a=aO.a||0.01;this.out_sx=aO.in_sx;this.out_sy=aO.in_sy;this.out_depth=aO.in_depth;this.layer_type='plu'},h=function(aU){var aU=aU||{};this.out_sx=aU.in_sx;this.out_sy=aU.in_sy;this.out_depth=aU.in_depth;this.layer_type='tanh'};b.prototype={forward:function(V){this.in_act=V;var C=V.clone(),N=V.w.length,D=C.w;for(var i=0;i<N;i++)D[i]<0&&(D[i]=D[i]*this.a);this.out_act=C;return this.out_act},backward:function(){var V=this.in_act,_b=this.out_act,N=V.w.length;V.dw=_.zeros(N);for(var i=0;i<N;i++)_b.w[i]<=0?V.dw[i]=_b.dw[i]*this.a:V.dw[i]=_b.dw[i]},getParamsAndGrads:function(){return[]},toJSON:function(){var _a={};_a.out_depth=this.out_depth;_a.out_sx=this.out_sx;_a.out_sy=this.out_sy;_a.layer_type=this.layer_type;return _a},fromJSON:function(_A){this.out_depth=_A.out_depth;this.out_sx=_A.out_sx;this.out_sy=_A.out_sy;this.layer_type=_A.layer_type}};c.prototype={forward:function(V){this.in_act=V;var _B=V.clone(),N=V.w.length,_d=_B.w;for(var i=0;i<N;i++)_d[i]<=0&&(_d[i]=this.a*(Math.exp(_d[i])-1));this.out_act=_B;return this.out_act},backward:function(){var V=this.in_act,aA=this.out_act,N=V.w.length;V.dw=_.zeros(N);for(var i=0;i<N;i++)aA.w[i]<=0?V.dw[i]=aA.dw[i]*Math.exp(aA.dw[i])*this.a:V.dw[i]=aA.dw[i]},getParamsAndGrads:function(){return[]},toJSON:function(){var aB={};aB.out_depth=this.out_depth;aB.out_sx=this.out_sx;aB.out_sy=this.out_sy;aB.layer_type=this.layer_type;return aB},fromJSON:function(aC){this.out_depth=aC.out_depth;this.out_sx=aC.out_sx;this.out_sy=aC.out_sy;this.layer_type=aC.layer_type}};d.prototype={forward:function(V){this.in_act=V;var aE=V.clone(),N=V.w.length,_D=aE.w;for(var i=0;i<N;i++)_D[i]<=0?_D[i]=this.b:_D[i]=_D[i]+this.b;this.out_act=aE;return this.out_act},backward:function(){var V=this.in_act,aF=this.out_act,N=V.w.length;V.dw=_.zeros(N);for(var i=0;i<N;i++)aF.w[i]<=0?V.dw[i]=0:V.dw[i]=aF.dw[i]},getParamsAndGrads:function(){return[]},toJSON:function(){var aG={};aG.out_depth=this.out_depth;aG.out_sx=this.out_sx;aG.out_sy=this.out_sy;aG.layer_type=this.layer_type;return aG},fromJSON:function(aH){this.out_depth=aH.out_depth;this.out_sx=aH.out_sx;this.out_sy=aH.out_sy;this.layer_type=aH.layer_type}};e.prototype={forward:function(V){this.in_act=V;var aJ=V.clone(),N=V.w.length,aK=aJ.w,_e=V.w;for(var i=0;i<N;i++)aK[i]=_e[i]/(1.0+Math.exp(-_e[i]));this.out_act=aJ;return this.out_act},backward:function(){var V=this.in_act,aL=this.out_act,N=V.w.length;V.dw=_.zeros(N);for(var i=0;i<N;i++){var _E=aL.w[i];V.dw[i]=(V.w[i]*(_E-_E*_E)+_E)*aL.dw[i]}},getParamsAndGrads:function(){return[]},toJSON:function(){var aM={};aM.out_depth=this.out_depth;aM.out_sx=this.out_sx;aM.out_sy=this.out_sy;aM.layer_type=this.layer_type;return aM},fromJSON:function(aN){this.out_depth=aN.out_depth;this.out_sx=aN.out_sx;this.out_sy=aN.out_sy;this.layer_type=aN.layer_type}};f.prototype={forward:function(V){this.in_act=V;var aP=V.clone(),N=V.w.length,aQ=aP.w;for(var i=0;i<N;i++)aQ[i]>1?aQ[i]=(aQ[i]-1)*this.a+1:aQ[i]<-1&&(aQ[i]=(aQ[i]+1)*this.a-1);this.out_act=aP;return this.out_act},backward:function(){var V=this.in_act,aR=this.out_act,N=V.w.length;V.dw=_.zeros(N);for(var i=0;i<N;i++)aR.w[i]<-1||aR.w[i]>1?V.dw[i]=aR.dw[i]*this.a:V.dw[i]=aR.dw[i]},getParamsAndGrads:function(){return[]},toJSON:function(){var aS={};aS.out_depth=this.out_depth;aS.out_sx=this.out_sx;aS.out_sy=this.out_sy;aS.layer_type=this.layer_type;return aS},fromJSON:function(aT){this.out_depth=aT.out_depth;this.out_sx=aT.out_sx;this.out_sy=aT.out_sy;this.layer_type=aT.layer_type}};function g(x){var y=Math.exp(2*x);return (y-1)/(y+1)}h.prototype={forward:function(V){this.in_act=V;var aV=V.cloneAndZero(),N=V.w.length;for(var i=0;i<N;i++)aV.w[i]=g(V.w[i]);this.out_act=aV;return this.out_act},backward:function(){var V=this.in_act,aW=this.out_act,N=V.w.length;V.dw=_.zeros(N);for(var i=0;i<N;i++){var aX=aW.w[i];V.dw[i]=(1.0-aX*aX)*aW.dw[i]}},getParamsAndGrads:function(){return[]},toJSON:function(){var aY={};aY.out_depth=this.out_depth;aY.out_sx=this.out_sx;aY.out_sy=this.out_sy;aY.layer_type=this.layer_type;return aY},fromJSON:function(aZ){this.out_depth=aZ.out_depth;this.out_sx=aZ.out_sx;this.out_sy=aZ.out_sy;this.layer_type=aZ.layer_type}};_.TanhLayer=h;_.LeakyReluLayer=b;_.EluLayer=c;_.FReluLayer=d;_.SwishLayer=e;_.PLULayer=f})(convnetjs);(function(bA){"use strict";var bB=bA.assert,_c=function(){this.layers=[]};_c.prototype={makeLayers:function(bC){bB(bC.length>=2,'Error! At least one input layer and one loss layer are required.');bB(bC[0].type=='input','Error! First layer must be the input layer, to declare size of inputs');bC=function(){var bE=[];for(var i=0;i<bC.length;i++){var bF=bC[i];bF.type=='softmax'||bF.type=='svm'&&bE.push({type:'fc',num_neurons:bF.num_classes});bF.type=='regression'&&bE.push({type:'fc',num_neurons:bF.num_neurons});(bF.type=='fc'||bF.type=='conv')&&A(bF.bias_pref)&&(bF.bias_pref=0.0,!A(bF.activation)&&(bF.activation=='relu'||bF.activation=='leaky_relu'||bF.activation=='elu'||bF.activation=='frelu')&&(bF.bias_pref=0.1));bE.push(bF);if(!A(bF.activation))if(bF.activation=='relu')bE.push({type:'relu'});else if(bF.activation=='leaky_relu')bE.push({type:'leaky_relu'});else if(bF.activation=='elu')bE.push({type:'elu'});else if(bF.activation=='frelu')bE.push({type:'frelu'});else if(bF.activation=='swish')bE.push({type:'swish'});else if(bF.activation=='plu')bE.push({type:'plu'});else if(bF.activation=='sigmoid')bE.push({type:'sigmoid'});else if(bF.activation=='tanh')bE.push({type:'tanh'});else if(bF.activation=='maxout'){var bG=bF.group_size!=='undefined'?bF.group_size:2;bE.push({type:'maxout',group_size:bG})}else console.log('ERROR unsupported activation '+bF.activation);!A(bF.drop_prob)&&bF.type!=='dropout'&&bE.push({type:'dropout',drop_prob:bF.drop_prob})}return bE}(bC);this.layers=[];for(var i=0;i<bC.length;i++){var _C=bC[i];if(i>0){var bD=this.layers[i-1];_C.in_sx=bD.out_sx;_C.in_sy=bD.out_sy;_C.in_depth=bD.out_depth}switch(_C.type) {case 'fc':this.layers.push(new bA.FullyConnLayer(_C));break;case 'lrn':this.layers.push(new bA.LocalResponseNormalizationLayer(_C));break;case 'dropout':this.layers.push(new bA.DropoutLayer(_C));break;case 'input':this.layers.push(new bA.InputLayer(_C));break;case 'softmax':this.layers.push(new bA.SoftmaxLayer(_C));break;case 'regression':this.layers.push(new bA.RegressionLayer(_C));break;case 'conv':this.layers.push(new bA.ConvLayer(_C));break;case 'pool':this.layers.push(new bA.PoolLayer(_C));break;case 'relu':this.layers.push(new bA.ReluLayer(_C));break;case 'leaky_relu':this.layers.push(new bA.LeakyReluLayer(_C));break;case 'elu':this.layers.push(new bA.EluLayer(_C));break;case 'frelu':this.layers.push(new bA.FReluLayer(_C));break;case 'swish':this.layers.push(new bA.SwishLayer(_C));break;case 'plu':this.layers.push(new bA.PLULayer(_C));break;case 'sigmoid':this.layers.push(new bA.SigmoidLayer(_C));break;case 'tanh':this.layers.push(new bA.TanhLayer(_C));break;case 'maxout':this.layers.push(new bA.MaxoutLayer(_C));break;case 'svm':this.layers.push(new bA.SVMLayer(_C));break;default:console.log('ERROR: UNRECOGNIZED LAYER TYPE: '+_C.type)}}},forward:function(V,bH){A((bH))&&(bH=!1);var bI=this.layers[0].forward(V,bH);for(var i=1;i<this.layers.length;i++)bI=this.layers[i].forward(bI,bH);return bI},getCostLoss:function(V,y){this.forward(V,!1);var N=this.layers.length;return this.layers[N-1].backward(y)},backward:function(y){var N=this.layers.length,bJ=this.layers[N-1].backward(y);for(var i=N-2;i>=0;i--)this.layers[i].backward();return bJ},getParamsAndGrads:function(){var bK=[];for(var i=0;i<this.layers.length;i++){var bL=this.layers[i].getParamsAndGrads();for(var j=0;j<bL.length;j++)bK.push(bL[j])}return bK},getPrediction:function(){var S=this.layers[this.layers.length-1],p=S.out_act.w,bM=p[0],bN=0;bB(S.layer_type=='softmax','getPrediction function assumes softmax as last layer of the net!');for(var i=1;i<p.length;i++)p[i]>bM&&(bM=p[i],bN=i);return bN},toJSON:function(){var bO={};bO.layers=[];for(var i=0;i<this.layers.length;i++)bO.layers.push(this.layers[i].toJSON());return bO},fromJSON:function(bP){this.layers=[];for(var i=0;i<bP.layers.length;i++){var bQ=bP.layers[i],t=bQ.layer_type,L;t=='input'&&(L=new bA.InputLayer());t=='relu'&&(L=new bA.ReluLayer());t=='leaky-relu'&&(L=new bA.LeakyReluLayer());t=='elu'&&(L=new bA.EluLayer());t=='frelu'&&(L=new bA.FReluLayer());t=='swish'&&(L=new bA.SwishLayer());t=='plu'&&(L=new bA.PLULayer());t=='sigmoid'&&(L=new bA.SigmoidLayer());t=='tanh'&&(L=new bA.TanhLayer());t=='dropout'&&(L=new bA.DropoutLayer());t=='conv'&&(L=new bA.ConvLayer());t=='pool'&&(L=new bA.PoolLayer());t=='lrn'&&(L=new bA.LocalResponseNormalizationLayer());t=='softmax'&&(L=new bA.SoftmaxLayer());t=='regression'&&(L=new bA.RegressionLayer());t=='fc'&&(L=new bA.FullyConnLayer());t=='maxout'&&(L=new bA.MaxoutLayer());t=='svm'&&(L=new bA.SVMLayer());L.fromJSON(bQ);this.layers.push(L)}}};bA.Net=_c})(convnetjs);
